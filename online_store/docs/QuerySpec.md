
# Query Spec

There are three query APIs provided

1. /entity/<int:entity_id>
2. /entity/match
3. /entity/query
4. /entity/query/loopback

## /entity/<int:entity_id>

API to query by Id that returns a single Entity Object or an Error

## /entity/match

API to match unique fields that returns a single Entity Object or an Error

Match API's only purpose is to check if the item already exists. This is done by matching the unique fields.
isCollection == True and label is an unique field, hence label matches only.
md5 is available only when isCollection  == false and its an unique value based on the media uploaded.

## /entity/query

API to query Entities based on parameters that returns a list of Entity object, encapsulated in a dictionary with metadata or an Error.

### Terminology

* parameter - parameters that are specified in the query.
* fields - fields in the entity object.
fields are mapped with one or more parameters to create different kind of queries.  
The fields are of different types, Bool, Int, Double, String, DateTime, enumerated etc. But the parameters are either Int, String or double. When querying for other types, the values are either integerized or stringified. This avoid many complexities in handling different formats.
* Bool values are converted to bool with the following: [true --> 1,  false --> 0].
* Date and DateTime values are converted into utcTimeStamp.

Some fields are nullable. So, sometimes we may need to query for entities with those fields set to valid value or having set to Null. To handle these type of queries, some parameters carry specal values \_\_null\_\_  and \_\_notnull\_\_. These parameters are called 'Null supported Parameters'

### Naming Convention

* The parameter names are always same as field names or have field name as prefix.
* There is no specific naming conventions, though snake case is preferred. Many fields are named with Pascal case or camel case due to various legacy reasons, like how exif tools name them to avoid unnecessary conversion. Due to which the Parameters have mixed case.
* All the parameter names and field names are case sensitive.

The following table lists all the parameters in alphabetic order

| Parameter         | Null supported |                                                       | Types Supported                     | Remarks                                                                                                                                                                                                                                                                                      |
| ----------------- | :------------: | ----------------------------------------------------- | ----------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| addedDate         |       No       | Integerized DateTime                                  |                                     |                                                                                                                                                                                                                                                                                              |
| addedDate_from    |       No       | Integerized DateTime                                  |                                     |                                                                                                                                                                                                                                                                                              |
| addedDate_till    |       No       | Integerized DateTime                                  |                                     |                                                                                                                                                                                                                                                                                              |
| addedDateTime     |       No       | Integerized DateTime                                  |                                     |                                                                                                                                                                                                                                                                                              |
| CreateDate        |      Yes       | Integerized DateTime                                  | isCollection=0                      |                                                                                                                                                                                                                                                                                              |
| CreateDate_day    |       No       | Int with Range 1-31                                   | isCollection=0                      |                                                                                                                                                                                                                                                                                              |
| CreateDate_from   |       No       | Integerized DateTime                                  | isCollection=0                      |                                                                                                                                                                                                                                                                                              |
| CreateDate_month  |       No       | Int with Range 1-12                                   | isCollection=0                      |                                                                                                                                                                                                                                                                                              |
| CreateDate_till   |       No       | Integerized DateTime                                  | isCollection=0                      |                                                                                                                                                                                                                                                                                              |
| CreateDate_year   |       No       | Int. Unreasonable year value will return empty result | isCollection=0                      |                                                                                                                                                                                                                                                                                              |
| CreateDateTime    |       No       | Integerized DateTime                                  | isCollection=0                      |                                                                                                                                                                                                                                                                                              |
| Duration          |       No       | Double                                                | type=video, audio                   |                                                                                                                                                                                                                                                                                              |
| Duration_min      |       No       | Double                                                | type=video, audio                   |                                                                                                                                                                                                                                                                                              |
| Duration_max      |       No       | Double                                                | type=video, audio                   |                                                                                                                                                                                                                                                                                              |
| extension         |       No       | String                                                | isCollection=0                      |                                                                                                                                                                                                                                                                                              |
| FileSizeMax       |       No       | Int,  in Bytes, NonZero Unsigned                      | isCollefdtion=0                     |                                                                                                                                                                                                                                                                                              |
| FileSizeMin       |       No       | Int,  in Bytes, NonZero Unsigned                      | isCollection=0                      |                                                                                                                                                                                                                                                                                              |
| id                |       No       | Int, NonZero, Unsigned                                |                                     |                                                                                                                                                                                                                                                                                              |
| ImageHeight       |       No       | Int, NonZero, Unsigned                                | isCollection=0<br>type=image, video |                                                                                                                                                                                                                                                                                              |
| ImageWidth        |       No       | Int, NonZero, Unsigned                                | isCollection=0<br>type=image, video |                                                                                                                                                                                                                                                                                              |
| isCollection      |       No       | Integerized Bool                                      |                                     |                                                                                                                                                                                                                                                                                              |
| isDeleted         |       No       | Integerized Bool                                      |                                     |                                                                                                                                                                                                                                                                                              |
| label             |      Yes       | String                                                |                                     | Query with a label.  label is partially unique field. i.e., this unique only when IsCollection is 1. hence Its suggested to use this fled with isCollection field to get a meaningful result.<br>if searching for a unique labeled collection, use /entity/match instead of this parameters. |
| label_starts_with |       No       | String                                                |                                     |                                                                                                                                                                                                                                                                                              |
| ~~md5~~           |     ~~No~~     | ~~String~~                                            | ~~isCollection=0~~                  | ~~This is an unique field, hence use /entity/match.~~                                                                                                                                                                                                                                        |
| MIMEType          |       No       | String                                                | isCollection=0                      |                                                                                                                                                                                                                                                                                              |
| parentId          |      Yes       | Int, NonZero, Unsigned                                |                                     |                                                                                                                                                                                                                                                                                              |
| type              |       No       | String, enumerated.                                   | isCollection=0                      |                                                                                                                                                                                                                                                                                              |
| updatedDate       |       No       | Integerized DateTime                                  |                                     |                                                                                                                                                                                                                                                                                              |
| updatedDate_from  |       No       | Integerized DateTime                                  |                                     |                                                                                                                                                                                                                                                                                              |
| updatedDate_till  |       No       | Integerized DateTime                                  |                                     |                                                                                                                                                                                                                                                                                              |
| updatedDateTime   |       No       | Integerized DateTime                                  |                                     |                                                                                                                                                                                                                                                                                              |
